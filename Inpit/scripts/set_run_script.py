# Muk3D script
import json
from muk3d.ui.forms import ask, get_float, get_filename, get_integer, get_directory, get_choice, get_checkbox
from muk3d.ooze import get_tailings_names

result = ask(fields=[
                    get_filename("Excel file", filters=['*.xls *.xlsx'], select_existing_file=True),
                    get_filename("Excel model", filters=['*.excelmodel',],  select_existing_file=True),
                    get_checkbox('Run everything', default_value=True)
                    ],
                    last_values_key='inpit-generate run script'
                    )
                    
if result is None:
    end()
    
if result['Run everything']:
    with open('run_everything.py', 'wt') as f:
        f.write('# autogenerated\n')
        f.write('import os.path\n')
        f.write("""
cmd = get_command('Run Excel model')
result = cmd({{   'end_at_row': 0,
    'filename': '{excelmodel}',
    'limit_runs': False,
    'resource_directory': os.path.abspath('.'),
    'sheet': os.path.abspath('{excelsheet}'),
    'start_at_row': 1,
    'start_directory': os.path.abspath('.')
    }})
        
        
        """.format(excelmodel=result['Excel model'],excelsheet=result["Excel file"])
        )
        
else:
    with open('run_one_timestep.py','wt') as f:
        f.write('# autogenerated\n')
        f.write('import os.path\n')
        f.write("""
        
import json
with open('base_data.json', 'rt') as f:
    data = json.load(f)
    run_index = data['run_index']
    
cmd = get_command('Run Excel model')
result = cmd({{   'end_at_row': run_index,
    'filename': '{excelmodel}',
    'limit_runs': True,
    'resource_directory': os.path.abspath('.'),
    'sheet': os.path.abspath('{excelsheet}'),
    'start_at_row': run_index,
    'start_directory': os.path.abspath('.')
    }})
    """.format(excelmodel=result['Excel model'],excelsheet=result["Excel file"]))